<!DOCTYPE html>

<html lang="en">

	<head>

		<meta charset="utf-8" />

		<title>Sam the Selfless Snake</title>

		<link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:bold' rel='stylesheet' type='text/css'>

		<style type="text/css">

			body {
				background:rgb(116, 114, 114);
				text-align:center;
			}

			canvas {
				background:rgb(253, 253, 253);
			}

			p.detail { 
				font-family: 'Arial', arial, serif; font-size:18px;
				text-indent: 0px;margin-bottom:20;margin-top:30px}
			
			span.name { 
				color:rgb(252, 252, 252);
				font-weight:bold;
				font-family: 'Arial', arial, serif; font-size:24px;
				text-indent: 0px;margin-bottom:20;margin-top:30px}

			h1 { font-family: 'Arial'; font-size:50px;
				 text-indent: 0px;margin-bottom:20;margin-top:30px}

			h2 { font-family: 'Arial', arial, serif; font-size:18px;
				 text-indent: 0px;margin-bottom:20;margin-top:30px}


		</style>

		<script type="text/javascript">

			function init() {

				var context;
				var newGame = false;
				var gameOver = false;
				var directionchange  = [];

				var snakepath = [];
				var snakelength = 1;

				var board = [];
				var currentDirection = Math.random() * 4 | 0;

				// not exactly sure of these calculations
				var Xhead = 5 + (Math.random() * (65 - 10))|0;
				var Yhead = 5 + (Math.random() * (50 - 10))|0;

				var tracker = document.getElementById('tracker');
				tracker.innerText = "0";

				var i;
				for (i = 0; i < 65; i++) {
					board[i] = [];
				}

				var canvas = document.createElement('canvas');
				canvas.setAttribute('width', 65 * 10);
				canvas.setAttribute('height', 50 * 10);
				context = canvas.getContext('2d');
				document.body.appendChild(canvas);

				var colors = ["blue", "green", "red"];

				function randomFood() {

					var x;
					var y;

					// randomize and check that the random spot is empty
					do {
						x = Math.random() * 65|0;
						y = Math.random() * 50|0;
					} while (board[x][y]);
 
					board[x][y] = 1;
					var item = colors[Math.floor(Math.random() * colors.length)];
					context.fillStyle = item;
					context.fillRect(x * 10 + 1, y * 10 + 1, 6, 6);
				}
				randomFood();

				function gameplay() {

					// wrap-around feature
					Xhead = (Xhead+65)%65;
					Yhead = (Yhead+50)%50;

					// check if snake should turn
					if (directionchange.length) {
						newTurn = directionchange.pop();
						if ((newTurn % 2) !== (currentDirection % 2)) {
							currentDirection = newTurn;
						}
					}

					// make the movement happen if it didn't collide with self:
					if (board[Xhead][Yhead]!=5) {

						// check if food eaten
						if (board[Xhead][Yhead]==1) {
							// TO DO: increement score later
							randomFood();
							snakelength++;
							//tracker.innerHTML = "<span style='color: red;'>**You have donated " + (snakelength * 10) + "</span>";
							tracker.innerText = "" + (snakelength * 10) + "";
						}
						context.fillStyle = "black";
						context.fillRect(Xhead * 10, Yhead * 10, 9, 9);
						board[Xhead][Yhead]=5;
						snakepath.unshift([Xhead, Yhead]);
						
						// add 4 cases of directionality:
						switch(currentDirection) {
							case 0:
								Xhead--; //left
								break;
							case 1:
								Yhead--; //up
								break;
							case 2:
								Xhead++; //right
								break;
							default:
								Yhead++; //down
						}

						// clear oldest snake bit if a new element wasn't added
						if (snakelength < snakepath.length) {
							oldest = snakepath.pop();
							// set them to zero on board and clear the spot
							board[oldest[0]][oldest[1]] = 0;
							context.clearRect(oldest[0] * 10, oldest[1] * 10, 10, 10);
						}

					} else {
						// self-collision occurs:
						gameOver = true;
						// lighten the snake
						for(var j = 0; j < snakepath.length; j++) {
							var oldest = snakepath.pop();
							// set them to zero on board and clear the spot
							board[oldest[0]][oldest[1]] = 0;
							context.fillStyle = "grey";
							context.fillRect(oldest[0] * 10, oldest[1] * 10, 9, 9);
						}
						score = snakelength*10;
						board[Xhead][Yhead]=5;
						context.font = "21px Times New Roman";
						context.fillStyle = "red";
						context.textAlign = "center";
						context.fillText("Game over. Thank you for feeding America. Press Space to Play again.", canvas.width/2, canvas.height/2);
						if (newGame) {
							context.fillStyle = "black";
							newGame = false;
							gameOver = false;
							//restart the game:
							context.clearRect(0, 0, 65 * 10, 50 * 10);

							snakepath = [];

							snakelength = 1;
							board = [];

							Xhead = 5 + (Math.random() * (65 - 10))|0;
							Yhead = 5 + (Math.random() * (50 - 10))|0;

							currentDirection = Math.random() * 4 | 0;

							// score = 0;
							// inc_score = 50;

							for (i = 0; i < 65; i++) {
								board[i] = [];
							}

							randomFood();

						}
					}
				}

				interval = window.setInterval(gameplay, 60);
				document.onkeydown = function(e) {
					var keyPressed = e.keyCode;
					if (37 <= keyPressed && keyPressed <= 40 && keyPressed - 37 !== directionchange[0]) {
						directionchange.unshift(keyPressed - 37);
					} else if (keyPressed == 32 && gameOver) {
						newGame = true;
					}
				}
			}


		</script>
	</head>

	<body onload="init()">
		<h1>Sam the Selfless Snake</h1>
		<p class="detail">You have donated <span class="name" id="tracker">0</span> meals to American families so far.</p>

	</body>
</html>